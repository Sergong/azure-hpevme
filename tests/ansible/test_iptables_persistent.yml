---
# Unit tests for iptables-persistent configuration

- name: Test iptables-persistent Configuration
  hosts: localhost
  gather_facts: no

  tasks:
    - name: Verify iptables-persistent package is installed
      ansible.builtin.set_fact:
        required_package: "iptables-persistent"

    - name: Assert iptables-persistent package is installed
      ansible.builtin.assert:
        that:
          - required_package == "iptables-persistent"
        fail_msg: "iptables-persistent package is not specified for installation."
        success_msg: "iptables-persistent package is correctly specified for installation."

    - name: Verify iptables rules are saved
      ansible.builtin.set_fact:
        save_command: "netfilter-persistent save"

    - name: Assert iptables rules are saved
      ansible.builtin.assert:
        that:
          - save_command == "netfilter-persistent save"
        fail_msg: "The command to save iptables rules is incorrect."
        success_msg: "iptables rules are correctly saved using netfilter-persistent."